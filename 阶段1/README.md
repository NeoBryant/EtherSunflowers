## å‰æœŸçƒ­èº«æŠ¥å‘Š

> å‚è€ƒåšå®¢ï¼š
>
> [ä»¥å¤ªåŠåŒºå—é“¾å­¦ä¹ ä¹‹æ­å»ºç§é“¾](https://blog.csdn.net/qq_35190319/article/details/79274870)
>
> [ä»¥å¤ªåŠåŒºå—é“¾å­¦ä¹ ä¹‹åœ¨ç§é“¾ä¸Šéƒ¨ç½²åˆçº¦](https://blog.csdn.net/qq_35190319/article/details/79283890)
>
> [ä»¥å¤ªåŠå­¦ä¹ ï¼ˆ4ï¼‰gethæ­å»ºç§æœ‰é“¾--åŠ å…¥èŠ‚ç‚¹](https://blog.csdn.net/dieju8330/article/details/81673175)



[TOC]

### ä»¥å¤ªåŠçš„å®‰è£…ã€ç§æœ‰é“¾åˆ›ä¸–åŒºå—æ­å»ºã€ç§æœ‰é“¾èŠ‚ç‚¹çš„åŠ å…¥ï¼ˆé€‰åšï¼‰

ä»¥ä¸‹æ“ä½œåœ¨unbuntuè™šæ‹Ÿæœºä¸Šè¿›è¡Œ

* **ä»¥å¤ªåŠçš„å®‰è£…**

  å®‰è£…æ–¹å¼è§ä»¥å¤ªåŠå®˜ç½‘ï¼šhttps://www.ethereum.org/cli

  å…¶ä¸­Unbuntuä¸­çš„å®‰è£…æ–¹æ³•æ˜¯åœ¨ç»ˆç«¯é‡Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

  ```
  sudo apt-get install software-properties-common
  sudo add-apt-repository -y ppa:ethereum/ethereum
  sudo apt-get update
  sudo apt-get install ethereum
  ```

  å¦‚ä¸‹å›¾å³å®‰è£…æˆåŠŸï¼š

  ![](imgs/gethInstall.png)

* **ç§æœ‰é“¾åˆ›ä¸–åŒºå—æ­å»º**

  åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹`mkdir privateNet`ï¼Œç„¶åè¿›å…¥è¯¥æ–‡ä»¶å¤¹`cd privateNet`ã€‚åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªgenesis.jsonæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

  ```json
  {
    "config": {
          "chainId": 10,
          "homesteadBlock": 0,
          "eip155Block": 0,
          "eip158Block": 0
      },
    "coinbase"   : "0x0000000000000000000000000000000000000000",
    "difficulty" : "0x2000",
    "extraData"  : "",
    "gasLimit"   : "0x8000000",
    "nonce"      : "0x0000000000000042",
    "mixhash"    : "0x0000000000000000000000000000000000000000000000000000000000000000",
    "parentHash" : "0x0000000000000000000000000000000000000000000000000000000000000000",
    "timestamp"  : "0x00",
    "alloc": {}
  }
  ```

  åˆ›å»ºåˆ›ä¸–åŒºå—ï¼š

  `geth --datadir "./" init genesis.json`

  æ‰§è¡ŒæˆåŠŸï¼š

  ![](imgs/createGenesis.png)

* **ç§æœ‰é“¾èŠ‚ç‚¹çš„åŠ å…¥**

  * åˆ›å»ºæ–‡ä»¶å¤¹`newPeer`ï¼ŒæŠŠä¸Šè¿°privateNetæ–‡ä»¶å¤¹ä¸­çš„genesis.jsonã€keystoreæ–‡ä»¶å¤¹å¤åˆ¶åˆ°newPeeræ–‡ä»¶å¤¹ä¸­

  * æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œåœ¨gethè¿›ç¨‹Aä¸­å¯åŠ¨èŠ‚ç‚¹ï¼š

    `geth --datadir "./" --networkid 989898 -rpc console --port 30304 --rpcport 8546`

    æ­¤æ—¶è¾“å…¥`net.peerCount`ï¼Œè¿”å›çš„æ˜¯0

  * æ‰“å¼€å¦å¤–ä¸€ä¸ªç»ˆç«¯ï¼Œ

    * åˆ›å»ºèŠ‚ç‚¹ï¼š`geth --datadir "./" init genesis.json`

    * åœ¨gethè¿›ç¨‹Bä¸­å¯åŠ¨èŠ‚ç‚¹ï¼Œæ³¨æ„ç«¯å£å·è·Ÿè¿›ç¨‹Aä¸åŒï¼š

      `geth --datadir "./" --networkid 989898 -rpc console --port 30305 --rpcport 8547`

    â€‹	å…¶ä¸­ï¼Œ**--networkid 989898  éœ€åŒè¿›ç¨‹Aä¸­çš„èŠ‚ç‚¹ä¸€è‡´**

    * æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼š`admin.nodeInfo.enode`ï¼Œå¦‚ä¸‹æ‰€ç¤º

      ![](imgs/newNode.png)

    * å°†[::]ä¸­çš„:: æ›¿æ¢æˆè™šæ‹ŸæœºBçš„ipï¼š

  * åœ¨è¿›ç¨‹Aä¸­ï¼ŒåŠ¨æ€æ·»åŠ èŠ‚ç‚¹å¹¶æ˜¾ç¤ºç»“æœï¼ŒèŠ‚ç‚¹æ·»åŠ æˆåŠŸï¼š

    ![](imgs/addPeer.png)



### å¯¹ getBlock ä¸­æ‰€å¾—åŒºå—çš„å„ä¸ªå­—æ®µè¿›è¡Œè§£é‡Š

è°ƒç”¨`getBlock`è¿”å›ä¿¡æ¯å¦‚ä¸‹ï¼š

![](imgs/getBlock.png)

å­—æ®µè§£é‡Šï¼š

`è¿”å›å€¼` - åŒºå—å¯¹è±¡ï¼š

* `difficulty` - BigNumberç±»å‹ã€‚å½“å‰å—çš„éš¾åº¦ï¼Œæ•´æ•°ã€‚
* `extraData` - å­—ç¬¦ä¸²ã€‚å½“å‰å—çš„extra dataå­—æ®µã€‚
* `gasLimit` - Numberï¼Œå½“å‰åŒºå—å…è®¸ä½¿ç”¨çš„æœ€å¤§gasã€‚
* `gasUsed` - å½“å‰åŒºå—ç´¯è®¡ä½¿ç”¨çš„æ€»çš„gasã€‚
* `hash` - å­—ç¬¦ä¸²ï¼ŒåŒºå—çš„å“ˆå¸Œä¸²ã€‚å½“è¿™ä¸ªåŒºå—å¤„äºpendingå°†ä¼šè¿”å›nullã€‚
* `logsBloom` - å­—ç¬¦ä¸²ï¼ŒåŒºå—æ—¥å¿—çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚å½“è¿™ä¸ªåŒºå—å¤„äºpendingå°†ä¼šè¿”å›nullã€‚
* `miner` - å­—ç¬¦ä¸²ï¼Œ20å­—èŠ‚ã€‚è¿™ä¸ªåŒºå—è·å¾—å¥–åŠ±çš„çŸ¿å·¥ã€‚
* `mixHash` - å­—ç¬¦ä¸²ã€‚ä¸nonceé…åˆç”¨äºæŒ–çŸ¿ï¼Œç”±ä¸Šä¸€ä¸ªåŒºå—çš„ä¸€éƒ¨åˆ†ç”Ÿæˆçš„hashã€‚
* `nonce` - å­—ç¬¦ä¸²ï¼Œ8å­—èŠ‚ã€‚POWç”Ÿæˆçš„å“ˆå¸Œã€‚å½“è¿™ä¸ªåŒºå—å¤„äºpendingå°†ä¼šè¿”å›nullã€‚
* `number` - åŒºå—å·ã€‚å½“è¿™ä¸ªåŒºå—å¤„äºpendingå°†ä¼šè¿”å›nullã€‚
* `parentHash` - å­—ç¬¦ä¸²ï¼Œ32å­—èŠ‚çš„çˆ¶åŒºå—çš„å“ˆå¸Œå€¼ã€‚
* `receiptsRoot` - å­—ç¬¦ä¸²ï¼Œ32å­—èŠ‚ã€‚åŒºå—çš„æ”¶æ®å‰ç¼€æ ‘çš„æ ¹å“ˆå¸Œå€¼ã€‚
* `sha3Uncles` - å­—ç¬¦ä¸²ï¼Œ32å­—èŠ‚ã€‚å”åŒºå—çš„å“ˆå¸Œå€¼ã€‚
* `size` - Numberã€‚å½“å‰è¿™ä¸ªå—çš„å­—èŠ‚å¤§å°ã€‚
* `stateRoot` - å­—ç¬¦ä¸²ï¼Œ32å­—èŠ‚ã€‚åŒºå—çš„æœ€ç»ˆçŠ¶æ€å‰ç¼€æ ‘çš„æ ¹å“ˆå¸Œå€¼ã€‚
* `timestamp` - Numberã€‚åŒºå—æ‰“åŒ…æ—¶çš„unixæ—¶é—´æˆ³ã€‚
* `totalDifficulty` - BigNumberç±»å‹ã€‚åŒºå—é“¾åˆ°å½“å‰å—çš„æ€»éš¾åº¦ï¼Œæ•´æ•°ã€‚
* `transactions` - æ•°ç»„ã€‚äº¤æ˜“å¯¹è±¡ã€‚æˆ–è€…æ˜¯32å­—èŠ‚çš„äº¤æ˜“å“ˆå¸Œã€‚
* `transactionsRoot` - å­—ç¬¦ä¸²ï¼Œ32å­—èŠ‚ã€‚åŒºå—çš„äº¤æ˜“å‰ç¼€æ ‘çš„æ ¹å“ˆå¸Œå€¼ã€‚
* `uncles` - æ•°ç»„ã€‚å”å“ˆå¸Œçš„æ•°ç»„ã€‚



### å¯¹æ—¥å¿—è¾“å‡ºè¿›è¡Œè§£é‡Š

åˆšå¯åŠ¨èŠ‚ç‚¹æ—¶çš„æ—¥å¿—è¾“å‡ºå¦‚ä¸‹ï¼Œæ˜¾ç¤ºäº†ä¸€äº›å½“å‰èŠ‚ç‚¹çš„è¿è¡Œä¿¡æ¯ä¸æƒ…å†µï¼š

![](imgs/log.png)

* ```
  INFO [11-04|19:41:35.226] Setting new local account                address=0xe2095De3103d651098a9fe755a711FF3F7F4F60A
  ```

  æ‰§è¡Œè§£é”è´¦æˆ·æ—¶çš„æ—¥å¿—è¾“å‡ºï¼Œ`address`æ˜¾ç¤ºçš„å°±æ˜¯åˆ›å»ºè´¦æˆ·æ—¶è¿”å›çš„å€¼

* ```
  INFO [11-04|19:41:35.226] Submitted contract creation              fullhash=0x68d53217f36f8dc9b34fd557b5d2db9f0ca220eee63a36148b9c99cec8ce0f5a contract=0xc5b3Dcf768C667cC41a52dd43f937F1aCf2d00eb
  ```

  æäº¤ç¼–å†™çš„æ™ºèƒ½åˆçº¦æ—¶çš„æ—¥å¿—è¾“å‡ºï¼Œ`fullhash`å°±æ˜¯å¯¹åº”transactionçš„å“ˆå¸Œå€¼ï¼Œå¯ä»¥é€šè¿‡`getTransaction`æŸ¥çœ‹

* ```
  INFO [11-04|19:42:28.914] Successfully sealed new block            number=59 sealhash=c828e9â€¦9026fc hash=1ba8baâ€¦21140b elapsed=14.119s
  DEBUG[11-04|19:42:28.915] Reinjecting stale transactions           count=0
  INFO [11-04|19:42:28.915] ğŸ”— block reached canonical chain          number=52 hash=7125d4â€¦b4a52f
  INFO [11-04|19:42:28.915] ğŸ”¨ mined potential block                  number=59 hash=1ba8baâ€¦21140b
  ```

  æŒ–åˆ°æ–°åŒºå—æ—¶çš„æ—¥å¿—è¾“å‡ºï¼Œnumberä¸ºå½“å‰åŒºå—å·


### ç¼–å†™ç®€å•çš„æ™ºèƒ½åˆçº¦ï¼Œåœ¨ remixä¸‹è¿›è¡Œè°ƒè¯•ï¼Œå¹¶éƒ¨ç½²åœ¨é“¾ä¸Šè¿›è¡Œè°ƒç”¨

æ™ºèƒ½åˆçº¦ä»£ç å¦‚ä¸‹ï¼š

```javascript
pragma solidity ^0.4.0;
contract Test {
    function fun(uint a) public pure returns (uint b)  {
        return a * 8;
    }
}
```

åŠŸèƒ½ï¼šè¾“å…¥ä¸€ä¸ªæ— ç¬¦å·æ•°`a`ï¼Œè¿”å›`a*8`

åœ¨remixä¸‹ç¼–è¯‘é€šè¿‡ï¼š

![](imgs/remix.png)

é¦–å…ˆè§£é”è´¦æˆ·ï¼š

`personal.unlockAccount(eth.accounts[0],"password")`

ç„¶åå¼€å§‹æŒ–çŸ¿ï¼š

`miner.start(1)`

ç‚¹å‡»DetailsæŒ‰é’®ï¼Œå¼¹å‡ºæ¶ˆæ¯æ¡†ï¼Œå¤åˆ¶WEB3DEPLOYä¸­çš„ä»£ç åˆ°ç»ˆç«¯ä¸­ï¼ŒæŒ‰ä¸‹å›è½¦ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œå½“ç»ˆç«¯è¿”å›ä¿¡æ¯`Contract mined!`ï¼Œåˆçº¦éƒ¨ç½²æˆåŠŸã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](imgs/contract.png)

ä¸åˆçº¦äº¤äº’ï¼š`test.fun.call(8)`ï¼Œè¿”å›64



### å¯¹äº¤æ˜“çš„å­—æ®µè¿›è¡Œè§£é‡Š

éƒ¨ç½²çš„åˆçº¦è¢«æŒ–åˆ°åæ˜¾ç¤ºçš„`Contract mined!`åé¢æœ‰ä¸€ä¸ª`transactionHash`ï¼Œæ˜¯è¯¥äº¤æ˜“çš„å“ˆå¸Œå€¼ã€‚

æ‰§è¡Œ`eth.getTransaction("0x68d53217f36f8dc9b34fd557b5d2db9f0ca220eee63a36148b9c99cec8ce0f5a")`

å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š

![](imgs/transaction.png)

å­—æ®µè§£é‡Šï¼š

* `blockHash`è¯¥äº¤æ˜“(äº‹åŠ¡ï¼Œtransaction)æ‰€åœ¨åŒºå—çš„å“ˆå¸Œå€¼
* `blockNumber`è¯¥äº¤æ˜“æ‰€åœ¨åŒºå—çš„åŒºå—å·
* `from`äº¤æ˜“å‘é€è€…çš„åœ°å€
* `to`äº¤æ˜“æ¥æ”¶è€…çš„åœ°å€ã€‚åˆ›å»ºä»¥å¤ªåŠæ™ºèƒ½åˆçº¦æ—¶ï¼Œtoçš„åœ°å€æ˜¯ç©ºçš„ã€‚å¦‚æœä¸ºç©ºåˆ™æ„å‘³è¿™æ˜¯ä¸€ä¸ªåˆ›å»ºæ™ºèƒ½åˆçº¦çš„äº¤æ˜“ã€‚
* `value`å‘é€è€…è¦è½¬ç§»ç»™æ¥æ”¶è€…çš„ä»¥å¤ªå¸æ•°é‡
* `data(input)`å­˜åœ¨çš„æ•°æ®å­—æ®µï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ˜¯è¡¨æ˜è¯¥äº¤æ˜“æ˜¯ä¸€ä¸ªåˆ›å»ºæˆ–è€…è°ƒç”¨æ™ºèƒ½åˆçº¦äº¤æ˜“
* `Gas Limit(Gas)`è¡¨ç¤ºè¿™ä¸ªäº¤æ˜“å…è®¸æ¶ˆè€—çš„æœ€å¤§Gasæ•°é‡
* `GasPrice`è¡¨ç¤ºå‘é€è€…æ„¿æ„æ”¯ä»˜ç»™çŸ¿å·¥çš„Gasä»·æ ¼
* `nonce`ç”¨æ¥åŒºåˆ«åŒä¸€ç”¨æˆ·å‘å‡ºçš„ä¸åŒäº¤æ˜“çš„æ ‡è®°
* `hash`ç”±ä»¥ä¸Šä¿¡æ¯ç”Ÿæˆçš„æ•£åˆ—å€¼ï¼ˆå“ˆå¸Œå€¼ï¼‰ï¼Œä½œä¸ºäº¤æ˜“çš„ID
* `r, s, v`äº¤æ˜“ç­¾åçš„ä¸‰ä¸ªéƒ¨åˆ†ï¼Œç”±å‘é€è€…çš„ç§é’¥å¯¹äº¤æ˜“hashè¿›è¡Œç­¾åç”Ÿæˆ